{"version":3,"file":"infinitescroll.min.js","sources":["../src/infinitescroll.js"],"sourcesContent":["/**\n * Add comment js logic.\n *\n * @package\n * @subpackage mod_evokeportfolio\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n/* eslint-disable */\ndefine(['jquery', 'core/ajax', 'core/templates'], function($, Ajax, Templates) {\n    var InfiniteScroll = function(courseid, type) {\n        this.courseid = courseid;\n\n        this.type = type;\n\n        this.targetdiv = '#' + type;\n\n        this.controlbutton = document.getElementById('tab-' + type);\n\n        this.loadItems();\n\n        $('.drawercontent').scroll(function(event) {\n            var scrollTop = event.target.scrollTop;\n            var scrollHeight = event.target.scrollHeight;\n            var offsetHeight = event.target.offsetHeight;\n\n            if (this.hasmoreitems && !this.wait && (scrollTop + offsetHeight > scrollHeight - 100)) {\n                if (!this.hasmoreitems) {\n                    return;\n                }\n\n                if (!this.wait) {\n                    this.loadItems();\n                }\n            }\n        }.bind(this));\n\n        $('.nav-pills .nav-link').click(function(event) {\n            this.controlbutton = event.target;\n\n            this.type = event.target.dataset.type;\n\n            this.hasmoreitems = event.target.dataset.hasmoreitems === 'true';\n\n            this.targetdiv = event.target.dataset.target;\n\n            this.loadItems();\n        }.bind(this));\n    }\n\n    InfiniteScroll.prototype.loadItems = function() {\n        this.wait = true;\n\n        const courseid = parseInt(this.controlbutton.dataset.courseid);\n        const limitcomments = parseInt(this.controlbutton.dataset.limitcomments);\n        const limitlikes = parseInt(this.controlbutton.dataset.limitlikes);\n        const limitskilpoints = parseInt(this.controlbutton.dataset.limitskilpoints);\n        const limitevocoins = parseInt(this.controlbutton.dataset.limitevocoins);\n        const limitbadges = parseInt(this.controlbutton.dataset.limitbadges);\n        const hasmoreitems = this.controlbutton.dataset.hasmoreitems === 'true';\n\n        const request = Ajax.call([{\n            methodname: 'block_evokefeed_load',\n            args: {\n                courseid: courseid,\n                type: this.type,\n                limitcomments: limitcomments,\n                limitlikes: limitlikes,\n                limitskilpoints: limitskilpoints,\n                limitevocoins: limitevocoins,\n                limitbadges: limitbadges,\n                hasmoreitems: hasmoreitems\n            }\n        }]);\n\n        request[0].done(function(response) {\n            const data = JSON.parse(response.data);\n\n            this.controlbutton.dataset.limitcomments = limitcomments + 1;\n            this.controlbutton.dataset.limitlikes = limitlikes + 1;\n            this.controlbutton.dataset.limitskilpoints = limitskilpoints + 1;\n            this.controlbutton.dataset.limitevocoins = limitevocoins + 1;\n            this.controlbutton.dataset.limitbadges = limitbadges + 1;\n            this.controlbutton.dataset.hasmoreitems = data.hasmoreitems;\n\n            this.hasmoreitems = data.hasmoreitems;\n\n            Templates.render('block_evokefeed/timeline-item', data).then(function(content) {\n                const targetdiv = $(this.targetdiv);\n\n                targetdiv.find('.loading-placeholder').addClass('hidden');\n\n                targetdiv.find('.timeline').append(content);\n\n                this.wait = false;\n            }.bind(this));\n\n            this.wait = false;\n        }.bind(this));\n    };\n\n    InfiniteScroll.prototype.wait = false;\n\n    InfiniteScroll.prototype.courseid = 0;\n\n    InfiniteScroll.prototype.type = 'team';\n\n    InfiniteScroll.prototype.targetdiv = '#team';\n\n    InfiniteScroll.prototype.controlbutton = null;\n\n    InfiniteScroll.prototype.hasmoreitems = true;\n\n    return {\n        'init': function(courseid, type) {\n            return new InfiniteScroll(courseid, type);\n        }\n    };\n});\n"],"names":["define","$","Ajax","Templates","InfiniteScroll","courseid","type","targetdiv","controlbutton","document","getElementById","loadItems","scroll","event","scrollTop","target","scrollHeight","offsetHeight","this","hasmoreitems","wait","bind","click","dataset","prototype","parseInt","limitcomments","limitlikes","limitskilpoints","limitevocoins","limitbadges","call","methodname","args","done","response","data","JSON","parse","render","then","content","find","addClass","append"],"mappings":"AASAA,wCAAO,CAAC,SAAU,YAAa,mBAAmB,SAASC,EAAGC,KAAMC,eAC5DC,eAAiB,SAASC,SAAUC,WAC/BD,SAAWA,cAEXC,KAAOA,UAEPC,UAAY,IAAMD,UAElBE,cAAgBC,SAASC,eAAe,OAASJ,WAEjDK,YAELV,EAAE,kBAAkBW,OAAO,SAASC,WAC5BC,UAAYD,MAAME,OAAOD,UACzBE,aAAeH,MAAME,OAAOC,aAC5BC,aAAeJ,MAAME,OAAOE,gBAE5BC,KAAKC,eAAiBD,KAAKE,MAASN,UAAYG,aAAeD,aAAe,IAAM,KAC/EE,KAAKC,oBAILD,KAAKE,WACDT,cAGfU,KAAKH,OAEPjB,EAAE,wBAAwBqB,MAAM,SAAST,YAChCL,cAAgBK,MAAME,YAEtBT,KAAOO,MAAME,OAAOQ,QAAQjB,UAE5Ba,aAAqD,SAAtCN,MAAME,OAAOQ,QAAQJ,kBAEpCZ,UAAYM,MAAME,OAAOQ,QAAQR,YAEjCJ,aACPU,KAAKH,eAGXd,eAAeoB,UAAUb,UAAY,gBAC5BS,MAAO,QAENf,SAAWoB,SAASP,KAAKV,cAAce,QAAQlB,UAC/CqB,cAAgBD,SAASP,KAAKV,cAAce,QAAQG,eACpDC,WAAaF,SAASP,KAAKV,cAAce,QAAQI,YACjDC,gBAAkBH,SAASP,KAAKV,cAAce,QAAQK,iBACtDC,cAAgBJ,SAASP,KAAKV,cAAce,QAAQM,eACpDC,YAAcL,SAASP,KAAKV,cAAce,QAAQO,aAClDX,aAA2D,SAA5CD,KAAKV,cAAce,QAAQJ,aAEhCjB,KAAK6B,KAAK,CAAC,CACvBC,WAAY,uBACZC,KAAM,CACF5B,SAAUA,SACVC,KAAMY,KAAKZ,KACXoB,cAAeA,cACfC,WAAYA,WACZC,gBAAiBA,gBACjBC,cAAeA,cACfC,YAAaA,YACbX,aAAcA,iBAId,GAAGe,KAAK,SAASC,gBACfC,KAAOC,KAAKC,MAAMH,SAASC,WAE5B5B,cAAce,QAAQG,cAAgBA,cAAgB,OACtDlB,cAAce,QAAQI,WAAaA,WAAa,OAChDnB,cAAce,QAAQK,gBAAkBA,gBAAkB,OAC1DpB,cAAce,QAAQM,cAAgBA,cAAgB,OACtDrB,cAAce,QAAQO,YAAcA,YAAc,OAClDtB,cAAce,QAAQJ,aAAeiB,KAAKjB,kBAE1CA,aAAeiB,KAAKjB,aAEzBhB,UAAUoC,OAAO,gCAAiCH,MAAMI,KAAK,SAASC,eAC5DlC,UAAYN,EAAEiB,KAAKX,WAEzBA,UAAUmC,KAAK,wBAAwBC,SAAS,UAEhDpC,UAAUmC,KAAK,aAAaE,OAAOH,cAE9BrB,MAAO,GACdC,KAAKH,YAEFE,MAAO,GACdC,KAAKH,QAGXd,eAAeoB,UAAUJ,MAAO,EAEhChB,eAAeoB,UAAUnB,SAAW,EAEpCD,eAAeoB,UAAUlB,KAAO,OAEhCF,eAAeoB,UAAUjB,UAAY,QAErCH,eAAeoB,UAAUhB,cAAgB,KAEzCJ,eAAeoB,UAAUL,cAAe,EAEjC,MACK,SAASd,SAAUC,aAChB,IAAIF,eAAeC,SAAUC"}
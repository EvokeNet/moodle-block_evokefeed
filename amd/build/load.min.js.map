{"version":3,"file":"load.min.js","sources":["../src/load.js"],"sourcesContent":["/**\n * Add comment js logic.\n *\n * @package\n * @subpackage mod_evokeportfolio\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n\ndefine(['core/ajax'], function(Ajax) {\n    var EvokeFeed = function() {\n        var blockdiv = document.querySelector('.block-evokefeed');\n\n        this.loaditems();\n\n        blockdiv.addEventListener(\"scroll\", function(event) {\n            var scrollTop = event.target.scrollTop;\n            var scrollHeight = event.target.scrollHeight;\n            var offsetHeight = event.target.offsetHeight;\n\n            var hasmoreitems = event.target.dataset.hasmoreitems === 'true';\n\n            if(scrollTop + offsetHeight > scrollHeight - 40) {\n                if (!hasmoreitems) {\n                    return;\n                }\n\n                if (!this.wait) {\n                    this.loaditems();\n                }\n            }\n        }.bind(this), false);\n    };\n\n    EvokeFeed.prototype.wait = false;\n\n    EvokeFeed.prototype.loaditems = function() {\n        this.wait = true;\n\n        var containerelement = document.querySelector('.block-evokefeed');\n\n        var courseid = parseInt(containerelement.dataset.courseid);\n        var limitcomments = parseInt(containerelement.dataset.limitcomments);\n        var limitlikes = parseInt(containerelement.dataset.limitlikes);\n        var limitskilpoints = parseInt(containerelement.dataset.limitskilpoints);\n        var limitevocoins = parseInt(containerelement.dataset.limitevocoins);\n        var limitbadges = parseInt(containerelement.dataset.limitbadges);\n        var hasmoreitems = containerelement.dataset.hasmoreitems === 'true';\n\n        var request = Ajax.call([{\n            methodname: 'block_evokefeed_load',\n            args: {\n                courseid: courseid,\n                limitcomments: limitcomments,\n                limitlikes: limitlikes,\n                limitskilpoints: limitskilpoints,\n                limitevocoins: limitevocoins,\n                limitbadges: limitbadges,\n                hasmoreitems: hasmoreitems\n            }\n        }]);\n\n        request[0].done(function(response) {\n            var loadingdiv = document.querySelector('.block_evokefeed .loading-placeholder');\n\n            loadingdiv.classList.add('hidden');\n\n            var data = JSON.parse(response.data);\n\n            containerelement.dataset.limitcomments = limitcomments + 1;\n            containerelement.dataset.limitlikes = limitlikes + 1;\n            containerelement.dataset.limitskilpoints = limitskilpoints + 1;\n            containerelement.dataset.limitevocoins = limitevocoins + 1;\n            containerelement.dataset.limitbadges = limitbadges + 1;\n            containerelement.dataset.hasmoreitems = data.hasmoreitems;\n\n            var ulelement = document.querySelector('.block-evokefeed .list-group');\n\n            data.items.forEach(function(element) {\n                var url = element.url;\n                url = url.replace(/&amp;/g, \"&\");\n\n                var listitem = document.createElement('a');\n                listitem.className = 'list-group-item list-group-item-action flex-column align-items-start fadein';\n                listitem.href = url;\n                listitem.innerHTML = '<div class=\"d-flex w-100 justify-content-between\">' +\n                    '<div class=\"images\">' +\n                    '<img src=\"'+ element.userimg +'\">' +\n                    '<i class=\"fa '+ element.icon +'\"></i>' +\n                    '</div>'+\n                    '<p>'+ element.userfullname +' <small>'+element.text+'</small></p>' +\n                    '</div>';\n\n                ulelement.appendChild(listitem);\n            });\n\n            this.wait = false;\n        }.bind(this));\n    };\n\n    return {\n        'init': function() {\n            return new EvokeFeed();\n        }\n    };\n});\n"],"names":["define","Ajax","EvokeFeed","blockdiv","document","querySelector","loaditems","addEventListener","event","scrollTop","target","scrollHeight","offsetHeight","hasmoreitems","dataset","this","wait","bind","prototype","containerelement","courseid","parseInt","limitcomments","limitlikes","limitskilpoints","limitevocoins","limitbadges","call","methodname","args","done","response","classList","add","data","JSON","parse","ulelement","items","forEach","element","url","replace","listitem","createElement","className","href","innerHTML","userimg","icon","userfullname","text","appendChild"],"mappings":"AASAA,8BAAO,CAAC,cAAc,SAASC,UACvBC,UAAY,eACRC,SAAWC,SAASC,cAAc,yBAEjCC,YAELH,SAASI,iBAAiB,SAAU,SAASC,WACrCC,UAAYD,MAAME,OAAOD,UACzBE,aAAeH,MAAME,OAAOC,aAC5BC,aAAeJ,MAAME,OAAOE,aAE5BC,aAAqD,SAAtCL,MAAME,OAAOI,QAAQD,gBAErCJ,UAAYG,aAAeD,aAAe,GAAI,KACxCE,oBAIAE,KAAKC,WACDV,cAGfW,KAAKF,OAAO,WAGlBb,UAAUgB,UAAUF,MAAO,EAE3Bd,UAAUgB,UAAUZ,UAAY,gBACvBU,MAAO,MAERG,iBAAmBf,SAASC,cAAc,oBAE1Ce,SAAWC,SAASF,iBAAiBL,QAAQM,UAC7CE,cAAgBD,SAASF,iBAAiBL,QAAQQ,eAClDC,WAAaF,SAASF,iBAAiBL,QAAQS,YAC/CC,gBAAkBH,SAASF,iBAAiBL,QAAQU,iBACpDC,cAAgBJ,SAASF,iBAAiBL,QAAQW,eAClDC,YAAcL,SAASF,iBAAiBL,QAAQY,aAChDb,aAAyD,SAA1CM,iBAAiBL,QAAQD,aAE9BZ,KAAK0B,KAAK,CAAC,CACrBC,WAAY,uBACZC,KAAM,CACFT,SAAUA,SACVE,cAAeA,cACfC,WAAYA,WACZC,gBAAiBA,gBACjBC,cAAeA,cACfC,YAAaA,YACbb,aAAcA,iBAId,GAAGiB,KAAK,SAASC,UACJ3B,SAASC,cAAc,yCAE7B2B,UAAUC,IAAI,cAErBC,KAAOC,KAAKC,MAAML,SAASG,MAE/Bf,iBAAiBL,QAAQQ,cAAgBA,cAAgB,EACzDH,iBAAiBL,QAAQS,WAAaA,WAAa,EACnDJ,iBAAiBL,QAAQU,gBAAkBA,gBAAkB,EAC7DL,iBAAiBL,QAAQW,cAAgBA,cAAgB,EACzDN,iBAAiBL,QAAQY,YAAcA,YAAc,EACrDP,iBAAiBL,QAAQD,aAAeqB,KAAKrB,iBAEzCwB,UAAYjC,SAASC,cAAc,gCAEvC6B,KAAKI,MAAMC,SAAQ,SAASC,aACpBC,IAAMD,QAAQC,IAClBA,IAAMA,IAAIC,QAAQ,SAAU,SAExBC,SAAWvC,SAASwC,cAAc,KACtCD,SAASE,UAAY,8EACrBF,SAASG,KAAOL,IAChBE,SAASI,UAAY,mFAEHP,QAAQQ,QAFL,kBAGAR,QAAQS,KAHR,kBAKVT,QAAQU,aAAc,WAAWV,QAAQW,KAL/B,qBAQrBd,UAAUe,YAAYT,kBAGrB3B,MAAO,GACdC,KAAKF,QAGJ,MACK,kBACG,IAAIb"}